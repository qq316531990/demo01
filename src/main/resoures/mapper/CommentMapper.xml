<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.CommentDao">

    <select id="count" resultType="int">
        select count(1) from comment where comment_state is null
    </select>

    <select id="find" resultType="com.pojo.Comment" parameterType="map">
         select * from comment where comment_state is not null limit #{page},#{size}
    </select>

    <select id="findHuiFu" resultType="com.pojo.Comment" parameterType="map">
         select * from comment where comment_state is null limit #{page},#{size}
    </select>


    <select id="countComment" resultType="int">
        select count(1) from comment where comment_state is not null
    </select>
    <delete id="delete" parameterType="com.pojo.Comment">
           delete from comment where comment_id=#{comment_id}
       </delete>
    <select id="findOne" resultType="com.pojo.Comment" parameterType="map">
          select * from comment where (user_id=#{cx_id} or book_id=#{cx_id}) and comment_state is not null limit #{page},#{size}
    </select>
    <select id="findTwo" resultType="com.pojo.Comment" parameterType="map">
          select * from comment where (user_id=#{cx_id} or parent_comment_id=#{cx_id}) and comment_state is null limit #{page},#{size}
    </select>

    <select id="findBook" resultType="com.pojo.Comment">
        select * from comment where book_id=#{book_id} and comment_state is not null limit #{page},#{size}
    </select>
    <insert id="add" parameterType="com.pojo.Comment">
        insert into comment(user_id,book_id,comment_content,comment_state)
        value (#{user_id},#{book_id},#{comment_content},#{comment_state})
    </insert>

    <update id="dianZan" parameterType="com.pojo.Comment">
       update comment set comment_great_number=#{comment_great_number} where comment_id=#{comment_id}
    </update>

    <update id="update" parameterType="com.pojo.Comment">
        update comment set comment_content=#{comment_content},comment_state=#{comment_state} where comment_id=#{comment_id}
    </update>

    <select id="findComment_id" resultType="com.pojo.Comment">
        select * from comment where comment_id=#{comment_id}
    </select>

    <insert id="huiFu" parameterType="com.pojo.Comment">
        insert into comment(user_id,book_id,parent_comment_id,comment_content)
        value (#{user_id},#{book_id},#{parent_comment_id},#{comment_content})
    </insert>

    <select id="huiFuList" resultType="com.pojo.Comment">
         select * from comment where book_id=#{book_id} and comment_state is null
    </select>

    <select id="findBook_id" resultType="com.pojo.Book">
        select * from book where book_id=#{bookId}
    </select>

    <select id="plList" resultType="com.pojo.Comment">
        select * from comment where user_id=#{user_id}
    </select>

    <select id="avg" resultType="double">
        select avg(comment_state) from comment
    </select>

</mapper>